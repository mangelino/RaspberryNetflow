<html ng-app="myApp">
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.min.js"></script>
    <script>
    // add the filter to your application module
angular.module('myApp', ['filters']);

/**
 * Filesize Filter
 * @Param length, default is 0
 * @return string
 */
angular.module('filters', [])
  .filter('Filesize', function () {
    return function (size) {
      if (isNaN(size))
        size = 0;

      if (size < 1024)
        return size + ' Bytes';

      size /= 1024;

      if (size < 1024)
        return size.toFixed(2) + ' Kb';

      size /= 1024;

      if (size < 1024)
        return size.toFixed(2) + ' Mb';

      size /= 1024;

      if (size < 1024)
        return size.toFixed(2) + ' Gb';

      size /= 1024;

      return size.toFixed(2) + ' Tb';
    };
  });
    </script>
    <script>
      var ws = new WebSocket("ws://raspberrypi.local:4201/");

      ws.onmessage = function(event) {
        var scope = angular.element(document.querySelector("#flows")).scope();

        scope.$apply(function() {
            var newFlow = angular.fromJson(event.data);
            var newFlows = [];
            var added = false;
            for (var i=0; i<scope.flows.length; i++) {
              if (scope.flows[i].src == newFlow.src) {
                newFlows.push(newFlow);
                added = true;
              } else {
                newFlows.push(scope.flows[i]);
              }
            }
            if (!added) {
                newFlows.push(newFlow);
            }
            scope.flows = newFlows;
        });
      }
  </script>
  </head>

  <body>
    <div>
    <input type="search" ng-model="q" placeholder="filter..." />
    <input type="search" ng-model="p" placeholder="filter..." />
      <table id="flows" ng-init='flows = []'>
      <thead>
        <th>Source</th>
        <th>Direction</th>
        <th>Destination</th>
      </thead>
      <tbody>
        <tr ng-repeat="src in flows | filter:q as results">
          <td>{{src.src}}</td><td>{{src.dir}}</td>
          <td>
            <table>
            <tr ng-repeat="flow in src.flows | filter:p">
             <td>{{flow.dst}}</td><td>{{flow.bytes | Filesize}}</td>
            </tr>
            </table>
          </td>
        <tr>
          
          </ul>
        </tr>
        </tbody>
      </table>
    </div>
  </body>
</html>